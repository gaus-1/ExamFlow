{% extends 'base.html' %}
{% load static %}

{% block title %}{{ subject.name }} - ExamFlow{% endblock %}

{% block content %}
<div class="container container-xl">
    <div class="section-header">
        <h1 class="section-title">
            {% if '–º–∞—Ç–µ–º–∞—Ç–∏–∫' in subject.name|lower %}üìê{% elif '—Ä—É—Å—Å–∫' in subject.name|lower %}üìù{% else %}üìö{% endif %}
            {{ subject.name }}
        </h1>
        <p class="section-subtitle">
            {% if subject.description %}
                {{ subject.description }}
            {% else %}
                –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –ï–ì–≠ –∏ –û–ì–≠ –ø–æ –ø—Ä–µ–¥–º–µ—Ç—É {{ subject.name|lower }}
            {% endif %}
        </p>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–µ–¥–º–µ—Ç–∞ -->
    <div class="stats-grid grid-cols-3 mb-12">
        <div class="stat-card">
            <div class="stat-number">{{ subject.task_count|default:0 }}</div>
            <div class="stat-label">–í—Å–µ–≥–æ –∑–∞–¥–∞–Ω–∏–π</div>
        </div>
        
        {% if user.is_authenticated and user_stats %}
        <div class="stat-card">
            <div class="stat-number">{{ user_stats.solved_tasks|default:0 }}</div>
            <div class="stat-label">–†–µ—à–µ–Ω–æ –≤–∞–º–∏</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-number">{{ user_stats.accuracy|default:0|floatformat:0 }}%</div>
            <div class="stat-label">–¢–æ—á–Ω–æ—Å—Ç—å</div>
        </div>
        {% else %}
        <div class="stat-card">
            <div class="stat-number">0</div>
            <div class="stat-label">–†–µ—à–µ–Ω–æ –≤–∞–º–∏</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-number">‚Äî</div>
            <div class="stat-label">–¢–æ—á–Ω–æ—Å—Ç—å</div>
        </div>
        {% endif %}
    </div>

    <!-- –î–µ–π—Å—Ç–≤–∏—è -->
    <div class="grid grid-cols-2 gap-8 max-w-4xl mx-auto mb-12">
        <div class="card text-center p-8">
            <div class="text-4xl mb-4">üé≤</div>
            <h3 class="text-xl font-semibold mb-4">–°–ª—É—á–∞–π–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ</h3>
            <p class="text-muted mb-6">
                –ü–æ–ª—É—á–∏—Ç–µ —Å–ª—É—á–∞–π–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ –ø–æ –ø—Ä–µ–¥–º–µ—Ç—É –¥–ª—è –ø—Ä–∞–∫—Ç–∏–∫–∏
            </p>
            <a href="{% url 'learning:random_task' %}?subject={{ subject.id }}" class="btn btn-primary">
                –ù–∞—á–∞—Ç—å –ø—Ä–∞–∫—Ç–∏–∫—É
            </a>
        </div>
        
        <div class="card text-center p-8">
            <div class="text-4xl mb-4">ü§ñ</div>
            <h3 class="text-xl font-semibold mb-4">–ò–ò-–ø–æ–º–æ—â–Ω–∏–∫</h3>
            <p class="text-muted mb-6">
                –ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å –ø–æ –ø—Ä–µ–¥–º–µ—Ç—É –Ω–∞—à–µ–º—É –ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç—É
            </p>
            <button onclick="askAI('{{ subject.name }}')" class="btn btn-primary">
                –°–ø—Ä–æ—Å–∏—Ç—å –ò–ò
            </button>
        </div>
    </div>

    <!-- –¢–µ–º—ã –ø—Ä–µ–¥–º–µ—Ç–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å) -->
    {% if topics %}
    <div class="mb-12">
        <h2 class="text-2xl font-semibold mb-6">–¢–µ–º—ã –ø—Ä–µ–¥–º–µ—Ç–∞</h2>
        <div class="grid grid-cols-3 gap-6">
            {% for topic in topics %}
            <div class="card p-6 hover-lift">
                <h3 class="font-semibold mb-2">{{ topic.name }}</h3>
                <p class="text-sm text-muted mb-4">
                    –ò–∑—É—á–∏—Ç–µ —Ç–µ–º—É {{ topic.name|lower }}
                </p>
                <a href="{% url 'learning:topic_detail' topic.id %}" class="btn btn-outline btn-sm">
                    –ò–∑—É—á–∞—Ç—å —Ç–µ–º—É
                </a>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- –ü—Ä–∏–º–µ—Ä—ã –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è –ò–ò -->
    <div class="bg-gray-50 p-8 rounded-lg">
        <h3 class="text-lg font-semibold mb-4 text-center">üí° –ü—Ä–∏–º–µ—Ä—ã –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è –ò–ò</h3>
        <div class="grid grid-cols-2 gap-4">
            {% if '–º–∞—Ç–µ–º–∞—Ç–∏–∫' in subject.name|lower %}
            <button onclick="askAI('–ö–∞–∫ —Ä–µ—à–∏—Ç—å –∫–≤–∞–¥—Ä–∞—Ç–Ω–æ–µ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ?')" class="ai-suggestion">
                üìê –ö–∞–∫ —Ä–µ—à–∏—Ç—å –∫–≤–∞–¥—Ä–∞—Ç–Ω–æ–µ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ?
            </button>
            <button onclick="askAI('–ß—Ç–æ —Ç–∞–∫–æ–µ –ø—Ä–æ–∏–∑–≤–æ–¥–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–∏?')" class="ai-suggestion">
                üìê –ß—Ç–æ —Ç–∞–∫–æ–µ –ø—Ä–æ–∏–∑–≤–æ–¥–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–∏?
            </button>
            <button onclick="askAI('–û–±—ä—è—Å–Ω–∏ —Ç–µ–æ—Ä–µ–º—É –ü–∏—Ñ–∞–≥–æ—Ä–∞')" class="ai-suggestion">
                üìê –û–±—ä—è—Å–Ω–∏ —Ç–µ–æ—Ä–µ–º—É –ü–∏—Ñ–∞–≥–æ—Ä–∞
            </button>
            <button onclick="askAI('–ö–∞–∫ –Ω–∞–π—Ç–∏ –ø–ª–æ—â–∞–¥—å —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞?')" class="ai-suggestion">
                üìê –ö–∞–∫ –Ω–∞–π—Ç–∏ –ø–ª–æ—â–∞–¥—å —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞?
            </button>
            {% elif '—Ä—É—Å—Å–∫' in subject.name|lower %}
            <button onclick="askAI('–ß—Ç–æ —Ç–∞–∫–æ–µ –ø—Ä–∏—á–∞—Å—Ç–∏–µ?')" class="ai-suggestion">
                üìù –ß—Ç–æ —Ç–∞–∫–æ–µ –ø—Ä–∏—á–∞—Å—Ç–∏–µ?
            </button>
            <button onclick="askAI('–ö–∞–∫ –ø–∏—Å–∞—Ç—å —Å–æ—á–∏–Ω–µ–Ω–∏–µ –ï–ì–≠?')" class="ai-suggestion">
                üìù –ö–∞–∫ –ø–∏—Å–∞—Ç—å —Å–æ—á–∏–Ω–µ–Ω–∏–µ –ï–ì–≠?
            </button>
            <button onclick="askAI('–ü—Ä–∞–≤–∏–ª–∞ –ø—É–Ω–∫—Ç—É–∞—Ü–∏–∏')" class="ai-suggestion">
                üìù –ü—Ä–∞–≤–∏–ª–∞ –ø—É–Ω–∫—Ç—É–∞—Ü–∏–∏
            </button>
            <button onclick="askAI('–î–µ–µ–ø—Ä–∏—á–∞—Å—Ç–Ω—ã–µ –æ–±–æ—Ä–æ—Ç—ã')" class="ai-suggestion">
                üìù –î–µ–µ–ø—Ä–∏—á–∞—Å—Ç–Ω—ã–µ –æ–±–æ—Ä–æ—Ç—ã
            </button>
            {% endif %}
        </div>
    </div>

    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <div class="text-center mt-12">
        <a href="{% url 'learning:subjects_list' %}" class="btn btn-outline">
            ‚Üê –ù–∞–∑–∞–¥ –∫ –ø—Ä–µ–¥–º–µ—Ç–∞–º
        </a>
        <a href="/" class="btn btn-ghost ml-4">
            üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é
        </a>
    </div>
</div>

<style>
.stats-grid {
    display: grid;
    gap: 2rem;
    margin-bottom: 3rem;
}

.stat-card {
    background: white;
    padding: 2rem;
    border-radius: 12px;
    text-align: center;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.stat-number {
    font-size: 2.5rem;
    font-weight: 600;
    color: var(--primary-600);
    margin-bottom: 0.5rem;
}

.stat-label {
    font-size: 0.875rem;
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.ai-suggestion {
    background: white;
    border: 1px solid var(--color-border);
    color: var(--color-text);
    padding: 1rem;
    border-radius: 8px;
    font-size: 0.875rem;
    text-align: left;
    cursor: pointer;
    transition: all 0.2s ease;
    width: 100%;
}

.ai-suggestion:hover {
    background: var(--primary-50);
    border-color: var(--primary-200);
    color: var(--primary-700);
}

@media (max-width: 768px) {
    .grid-cols-3 {
        grid-template-columns: 1fr;
    }
    
    .grid-cols-2 {
        grid-template-columns: 1fr;
    }
}
</style>
{% endblock %}

{% block extra_js %}
<script>
function askAI(question) {
    // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å –≤–æ–ø—Ä–æ—Å–æ–º
    const aiSection = document.getElementById('ai-interface');
    if (aiSection) {
        window.location.href = '/#ai-interface';
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º sessionStorage –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –≤–æ–ø—Ä–æ—Å–∞
        sessionStorage.setItem('aiQuestion', question);
    }
}

// –ù–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –≤–æ–ø—Ä–æ—Å
if (window.location.hash === '#ai-interface' && sessionStorage.getItem('aiQuestion')) {
    setTimeout(() => {
        const aiInput = document.getElementById('aiInput');
        if (aiInput) {
            aiInput.value = sessionStorage.getItem('aiQuestion');
            sessionStorage.removeItem('aiQuestion');
            aiInput.focus();
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤–æ–ø—Ä–æ—Å
            if (typeof window.examFlowApp !== 'undefined' && window.examFlowApp.sendAIQuery) {
                window.examFlowApp.sendAIQuery();
            }
        }
    }, 500);
}
</script>
{% endblock %}
