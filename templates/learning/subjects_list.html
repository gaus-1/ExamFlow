{% extends 'base.html' %}
{% load static %}

{% block title %}–ü—Ä–µ–¥–º–µ—Ç—ã - ExamFlow{% endblock %}

{% block content %}
<div class="container container-xl">
    <div class="section-header">
        <h1 class="section-title">–ü—Ä–µ–¥–º–µ—Ç—ã –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏</h1>
        <p class="section-subtitle">
            –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è. –£ –Ω–∞—Å –µ—Å—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª—ã –ø–æ –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ –∏ —Ä—É—Å—Å–∫–æ–º—É —è–∑—ã–∫—É –¥–ª—è –ï–ì–≠ –∏ –û–ì–≠.
        </p>
    </div>

    {% if subjects %}
    <div class="grid grid-cols-2 gap-8 max-w-4xl mx-auto">
        {% for subject in subjects %}
        <div class="card hover-lift text-center">
            <div class="feature-icon mb-4">
                {% if '–º–∞—Ç–µ–º–∞—Ç–∏–∫' in subject.name|lower %}üìê
                {% elif '—Ä—É—Å—Å–∫' in subject.name|lower %}üìù
                {% else %}üìö
                {% endif %}
            </div>
            
            <h3 class="feature-title mb-4">{{ subject.name }}</h3>
            
            <div class="text-sm text-muted mb-6">
                {% if subject.description %}
                    {{ subject.description|truncatewords:15 }}
                {% else %}
                    –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –ï–ì–≠ –∏ –û–ì–≠ –ø–æ –ø—Ä–µ–¥–º–µ—Ç—É {{ subject.name|lower }}
                {% endif %}
            </div>

            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–¥–∞–Ω–∏–π -->
            <div class="stats-mini mb-6">
                <div class="stat-item">
                    <div class="stat-number">{{ subject.task_count|default:0 }}</div>
                    <div class="stat-label">–ó–∞–¥–∞–Ω–∏–π</div>
                </div>
                {% if user.is_authenticated and subject.user_progress %}
                <div class="stat-item">
                    <div class="stat-number">{{ subject.user_progress }}</div>
                    <div class="stat-label">–†–µ—à–µ–Ω–æ</div>
                </div>
                {% endif %}
            </div>

            <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
            <div class="flex flex-col gap-3">
                <a href="{% url 'learning:subject_detail' subject.id %}" class="btn btn-primary" rel="nofollow">
                    üìö –ò–∑—É—á–∞—Ç—å –ø—Ä–µ–¥–º–µ—Ç
                </a>
                
                <a href="{% url 'learning:random_task_subject' subject.id %}" class="btn btn-outline" rel="nofollow">
                    üé≤ –°–ª—É—á–∞–π–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ
                </a>
                
                <button onclick="askAI('{{ subject.name }}')" class="btn btn-ghost">
                    ü§ñ –°–ø—Ä–æ—Å–∏—Ç—å –ò–ò
                </button>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="text-center py-16">
        <div class="feature-icon mb-4">üìö</div>
        <h3 class="text-xl font-semibold mb-4">–ü—Ä–µ–¥–º–µ—Ç—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è...</h3>
        <p class="text-muted mb-8">
            –ú—ã –¥–æ–±–∞–≤–ª—è–µ–º –º–∞—Ç–µ—Ä–∏–∞–ª—ã –ø–æ –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ –∏ —Ä—É—Å—Å–∫–æ–º—É —è–∑—ã–∫—É. 
            –ü–æ–∫–∞ –º–æ–∂–µ—Ç–µ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ò–ò-–ø–æ–º–æ—â–Ω–∏–∫–æ–º.
        </p>
        <a href="/#ai-interface" class="btn btn-primary">
            ü§ñ –ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å –ò–ò
        </a>
    </div>
    {% endif %}

    <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ -->
    <div class="mt-16 text-center">
        <h3 class="text-lg font-semibold mb-6">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏</h3>
        <div class="grid grid-cols-3 gap-6 max-w-2xl mx-auto">
            <a href="/#ai-interface" class="card text-center p-6 hover-lift">
                <div class="text-2xl mb-2">ü§ñ</div>
                <div class="font-medium">–ò–ò-–ø–æ–º–æ—â–Ω–∏–∫</div>
                <div class="text-sm text-muted">–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã</div>
            </a>
            
            <a href="https://t.me/examflow_bot" class="card text-center p-6 hover-lift">
                <div class="text-2xl mb-2">üì±</div>
                <div class="font-medium">Telegram –±–æ—Ç</div>
                <div class="text-sm text-muted">–£—á–∏—Å—å –≤–µ–∑–¥–µ</div>
            </a>
            
            <a href="{% url 'learning:random_task' %}" class="card text-center p-6 hover-lift">
                <div class="text-2xl mb-2">üéØ</div>
                <div class="font-medium">–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</div>
                <div class="text-sm text-muted">–°–ª—É—á–∞–π–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è</div>
            </a>
        </div>
    </div>
</div>

<style>
.stats-mini {
    display: flex;
    justify-content: center;
    gap: 2rem;
    padding: 1rem 0;
    border-top: 1px solid var(--color-border);
    border-bottom: 1px solid var(--color-border);
}

.stat-item {
    text-align: center;
}

.stat-number {
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--primary-600);
}

.stat-label {
    font-size: 0.75rem;
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

@media (max-width: 768px) {
    .grid-cols-2 {
        grid-template-columns: 1fr;
    }
    
    .grid-cols-3 {
        grid-template-columns: 1fr;
    }
    
    .stats-mini {
        gap: 1rem;
    }
}
</style>
{% endblock %}

{% block extra_js %}
<script>
function askAI(subjectName) {
    const questions = {
        '–º–∞—Ç–µ–º–∞—Ç–∏–∫–∞': '–ö–∞–∫ —Ä–µ—à–∞—Ç—å –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ —É—Ä–∞–≤–Ω–µ–Ω–∏—è?',
        '—Ä—É—Å—Å–∫–∏–π': '–ß—Ç–æ —Ç–∞–∫–æ–µ –ø—Ä–∏—á–∞—Å—Ç–∏–µ –≤ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ?'
    };
    
    const defaultQuestion = questions[subjectName.toLowerCase()] || `–†–∞—Å—Å–∫–∞–∂–∏ –ø—Ä–æ ${subjectName}`;
    
    // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å –≤–æ–ø—Ä–æ—Å–æ–º
    const aiSection = document.getElementById('ai-interface');
    if (aiSection) {
        window.location.href = '/#ai-interface';
        setTimeout(() => {
            const aiInput = document.getElementById('aiInput');
            if (aiInput) {
                aiInput.value = defaultQuestion;
                aiInput.focus();
            }
        }, 500);
    }
}
</script>
{% endblock %}
