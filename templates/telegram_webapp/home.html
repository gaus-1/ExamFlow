{% extends 'telegram_webapp/base.html' %}

{% block content %}
<div class="welcome-message">
    <p style="text-align: center; margin-bottom: 24px; color: var(--tg-theme-hint-color, #999999);">
        –ü—Ä–∏–≤–µ—Ç! üëã –ì–æ—Ç–æ–≤ –ø–æ–º–æ—á—å —Å –ø–æ–¥–≥–æ—Ç–æ–≤–∫–æ–π –∫ –ï–ì–≠ –∏ –û–ì–≠!
    </p>
</div>

<div class="button-grid">
    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –ò–ò -->
    <button class="btn btn-primary" onclick="goToAIChat()">
        ü§ñ –°–ü–†–û–°–ò–¢–¨ –ò–ò
    </button>
    
    <!-- –í—Ç–æ—Ä–∞—è —Å—Ç—Ä–æ–∫–∞ –∫–Ω–æ–ø–æ–∫ -->
    <div class="button-row">
        <button class="btn btn-secondary" onclick="goToSubjects()">
            üìö –ü–†–ê–ö–¢–ò–ö–ê
        </button>
        <button class="btn btn-secondary" onclick="goToStats()">
            üèÜ –ü–†–û–ì–†–ï–°–°
        </button>
    </div>
    
    <!-- –ö–Ω–æ–ø–∫–∞ —Å–∞–π—Ç–∞ -->
    <button class="btn btn-secondary" onclick="openWebsite()">
        üåê –°–ê–ô–¢
    </button>
</div>

<div class="stats-preview" style="margin-top: 32px;">
    <h3 style="text-align: center; margin-bottom: 16px; color: var(--tg-theme-text-color, #000000);">
        üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
    </h3>
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-number" id="subjectsCount">-</div>
            <div class="stat-label">–ü—Ä–µ–¥–º–µ—Ç–æ–≤</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="tasksCount">-</div>
            <div class="stat-label">–ó–∞–¥–∞–Ω–∏–π</div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function openWebsite() {
    window.Telegram.WebApp.openLink('https://examflow.ru');
}

// –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
async function loadStats() {
    try {
        const response = await fetch('/webapp/stats/');
        if (response.ok) {
            const html = await response.text();
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            
            const subjectsElement = doc.querySelector('[data-subjects-count]');
            const tasksElement = doc.querySelector('[data-tasks-count]');
            
            if (subjectsElement && tasksElement) {
                document.getElementById('subjectsCount').textContent = subjectsElement.dataset.subjectsCount;
                document.getElementById('tasksCount').textContent = tasksElement.dataset.tasksCount;
            }
        }
    } catch (error) {
        console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É:', error);
        document.getElementById('subjectsCount').textContent = '5';
        document.getElementById('tasksCount').textContent = '25';
    }
}

// –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', loadStats);
</script>
{% endblock %}
