#!/usr/bin/env python3
"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è –¥–µ–ø–ª–æ—è –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è –¥–∏–∑–∞–π–Ω–æ–≤ –Ω–∞ ExamFlow
"""

import os
import shutil
from pathlib import Path

def deploy_themes():
    """–î–µ–ø–ª–æ–π –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è –¥–∏–∑–∞–π–Ω–æ–≤"""
    print("üé® –î–ï–ü–õ–û–ô –ü–ï–†–ï–ö–õ–Æ–ß–ê–¢–ï–õ–Ø –î–ò–ó–ê–ô–ù–û–í EXAMFLOW")
    print("=" * 50)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
    if not os.path.exists('templates/base.html'):
        print("‚ùå –û—à–∏–±–∫–∞: templates/base.html –Ω–µ –Ω–∞–π–¥–µ–Ω")
        print("   –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏–∑ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞")
        return False
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º–æ–¥—É–ª—å themes —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    if not os.path.exists('themes/'):
        print("‚ùå –û—à–∏–±–∫–∞: –º–æ–¥—É–ª—å themes –Ω–µ –Ω–∞–π–¥–µ–Ω")
        return False
    
    print("‚úÖ –í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ–∞–π–ª—ã –Ω–∞–π–¥–µ–Ω—ã")
    
    # 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ base.html
    with open('templates/base.html', 'r', encoding='utf-8') as f:
        base_content = f.read()
    
    if 'theme-switcher-container' in base_content:
        print("‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –¥–∏–∑–∞–π–Ω–æ–≤ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ base.html")
    else:
        print("‚ùå –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –¥–∏–∑–∞–π–Ω–æ–≤ –ù–ï –Ω–∞–π–¥–µ–Ω –≤ base.html")
        print("   –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å HTML –∫–æ–¥ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è")
        return False
    
    # 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ CSS
    if 'themes.css' in base_content:
        print("‚úÖ CSS —Ñ–∞–π–ª themes.css –ø–æ–¥–∫–ª—é—á–µ–Ω")
    else:
        print("‚ùå CSS —Ñ–∞–π–ª themes.css –ù–ï –ø–æ–¥–∫–ª—é—á–µ–Ω")
        return False
    
    # 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ JS
    if 'theme-switcher.js' in base_content:
        print("‚úÖ JS —Ñ–∞–π–ª theme-switcher.js –ø–æ–¥–∫–ª—é—á–µ–Ω")
    else:
        print("‚ùå JS —Ñ–∞–π–ª theme-switcher.js –ù–ï –ø–æ–¥–∫–ª—é—á–µ–Ω")
        return False
    
    # 4. –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç
    css_file = 'themes/static/css/themes.css'
    js_file = 'themes/static/js/theme-switcher.js'
    
    if os.path.exists(css_file):
        print("‚úÖ CSS —Ñ–∞–π–ª themes.css —Å—É—â–µ—Å—Ç–≤—É–µ—Ç")
    else:
        print("‚ùå CSS —Ñ–∞–π–ª themes.css –ù–ï –Ω–∞–π–¥–µ–Ω")
        return False
    
    if os.path.exists(js_file):
        print("‚úÖ JS —Ñ–∞–π–ª theme-switcher.js —Å—É—â–µ—Å—Ç–≤—É–µ—Ç")
    else:
        print("‚ùå JS —Ñ–∞–π–ª theme-switcher.js –ù–ï –Ω–∞–π–¥–µ–Ω")
        return False
    
    # 5. –°–æ–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
    print("\nüì¶ –°–±–æ—Ä–∫–∞ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤...")
    try:
        os.system('python manage.py collectstatic --noinput')
        print("‚úÖ –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã —Å–æ–±—Ä–∞–Ω—ã")
    except Exception as e:
        print(f"‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ —Å–±–æ—Ä–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤: {e}")
    
    # 6. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    print("\nüîç –§–ò–ù–ê–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê:")
    print("-" * 30)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –≤–∏–¥–µ–Ω –≤ HTML
    if 'üéì –®–∫–æ–ª—å–Ω–∏–∫' in base_content and 'üëî –í–∑—Ä–æ—Å–ª—ã–π' in base_content:
        print("‚úÖ –ö–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è –Ω–∞–π–¥–µ–Ω—ã –≤ HTML")
    else:
        print("‚ùå –ö–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è –ù–ï –Ω–∞–π–¥–µ–Ω—ã –≤ HTML")
        return False
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞—Ç—Ä–∏–±—É—Ç data-theme
    if 'data-theme="school"' in base_content:
        print("‚úÖ –ê—Ç—Ä–∏–±—É—Ç data-theme –¥–æ–±–∞–≤–ª–µ–Ω –∫ body")
    else:
        print("‚ùå –ê—Ç—Ä–∏–±—É—Ç data-theme –ù–ï –Ω–∞–π–¥–µ–Ω")
        return False
    
    print("\nüéâ –ü–ï–†–ï–ö–õ–Æ–ß–ê–¢–ï–õ–¨ –î–ò–ó–ê–ô–ù–û–í –ì–û–¢–û–í –ö –î–ï–ü–õ–û–Æ!")
    print("\nüìã –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ:")
    print("1. –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è: git add . && git commit -m 'Add theme switcher'")
    print("2. –ó–∞–ø—É—à–∏—Ç—å –Ω–∞ GitHub: git push origin main")
    print("3. –î–æ–∂–¥–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è –Ω–∞ Render")
    print("4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –Ω–∞ https://examflow.ru/")
    
    return True

def check_deployment_status():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –¥–µ–ø–ª–æ—è"""
    print("\nüîç –ü–†–û–í–ï–†–ö–ê –°–¢–ê–¢–£–°–ê –î–ï–ü–õ–û–Ø:")
    print("=" * 30)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º git —Å—Ç–∞—Ç—É—Å
    print("üìä Git —Å—Ç–∞—Ç—É—Å:")
    os.system('git status --porcelain')
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∫–æ–º–º–∏—Ç—ã
    print("\nüìù –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∫–æ–º–º–∏—Ç—ã:")
    os.system('git log --oneline -5')
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —É–¥–∞–ª–µ–Ω–Ω—ã–µ –≤–µ—Ç–∫–∏
    print("\nüåê –£–¥–∞–ª–µ–Ω–Ω—ã–µ –≤–µ—Ç–∫–∏:")
    os.system('git remote -v')

if __name__ == "__main__":
    print("üöÄ –ó–∞–ø—É—Å–∫ –¥–µ–ø–ª–æ—è –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è –¥–∏–∑–∞–π–Ω–æ–≤...")
    
    if deploy_themes():
        check_deployment_status()
        print("\n‚úÖ –î–µ–ø–ª–æ–π –≥–æ—Ç–æ–≤! –¢–µ–ø–µ—Ä—å –∑–∞–∫–æ–º–º–∏—Ç—å—Ç–µ –∏ –∑–∞–ø—É—à—å—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è.")
    else:
        print("\n‚ùå –î–µ–ø–ª–æ–π –Ω–µ —É–¥–∞–ª—Å—è. –ò—Å–ø—Ä–∞–≤—å—Ç–µ –æ—à–∏–±–∫–∏ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.")
