{% extends 'base.html' %}

{% block content %}
<div class="container">
    <h2>Панель управления Telegram-ботом</h2>
    
    <div class="status-card">
        <h3>Статус бота</h3>
        <div class="status {% if status == 'running' %}success{% else %}error{% endif %}">
            {{ status|upper }}
        </div>
        {% if status == 'running' %}
        <div class="pid">PID: {{ pid }}</div>
        {% endif %}
    </div>
    
    <div class="actions">
        <button class="btn btn-primary" onclick="location.href='/bot/start/'">
            Запустить бота
        </button>
        <button class="btn btn-warning" onclick="location.href='/bot/restart/'">
            Перезапустить
        </button>
        <button class="btn btn-danger" onclick="location.href='/bot/stop/'">
            Остановить
        </button>
    </div>
    
    <div class="info">
        <h4>Информация:</h4>
        <ul>
            <li>Бот запускается автоматически при первом посещении сайта</li>
            <li>При падении бота его можно перезапустить через эту панель</li>
            <li>Статус обновляется автоматически каждые 30 секунд</li>
        </ul>
    </div>
</div>

<script>
// Автоматическое обновление статуса
setInterval(() => {
    fetch('/bot/status/')
        .then(response => response.json())
        .then(data => {
            const statusElement = document.querySelector('.status');
            const statusCard = document.querySelector('.status-card');
            
            statusElement.textContent = data.status.toUpperCase();
            statusCard.className = 'status ' + (data.status === 'running' ? 'success' : 'error');
            
            if (data.pid && data.pid !== 'N/A') {
                let pidElement = document.querySelector('.pid');
                if (pidElement) {
                    pidElement.textContent = 'PID: ' + data.pid;
                }
            }
        })
        .catch(error => console.error('Error fetching bot status:', error));
}, 30000); // Обновляем каждые 30 секунд
</script>

<style>
.status-card {
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 8px;
    padding: 20px;
    margin: 20px 0;
    text-align: center;
}

.status {
    font-size: 18px;
    font-weight: bold;
    padding: 10px;
    border-radius: 4px;
    margin: 10px 0;
}

.status.success {
    background-color: #d4edda;
    color: #155724;
}

.status.error {
    background-color: #f8d7da;
    color: #721c24;
}

.pid {
    color: #6c757d;
    font-size: 14px;
}

.actions {
    display: flex;
    gap: 10px;
    justify-content: center;
    margin: 20px 0;
}

.info {
    background: #e9ecef;
    padding: 20px;
    border-radius: 8px;
    margin-top: 20px;
}

.info ul {
    text-align: left;
}

.info li {
    margin: 5px 0;
}
</style>
{% endblock %}
