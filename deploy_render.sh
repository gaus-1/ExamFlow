#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–µ–ø–ª–æ—è –Ω–∞ Render

echo "üöÄ –ë—ã—Å—Ç—Ä—ã–π –¥–µ–ø–ª–æ–π ExamFlow –Ω–∞ Render..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –º—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –≤–µ—Ç–∫–µ
if [ "$(git branch --show-current)" != "main" ]; then
    echo "‚ùå –û—à–∏–±–∫–∞: –Ω—É–∂–Ω–æ –±—ã—Ç—å –≤ –≤–µ—Ç–∫–µ main"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –Ω–µ—Ç –Ω–µ–∑–∞–∫–æ–º–º–∏—á–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
if ! git diff-index --quiet HEAD --; then
    echo "‚ùå –û—à–∏–±–∫–∞: –µ—Å—Ç—å –Ω–µ–∑–∞–∫–æ–º–º–∏—á–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è"
    git status
    exit 1
fi

# –ö–æ–º–º–∏—Ç–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
echo "üìù –ö–æ–º–º–∏—Ç–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è..."
git add .
git commit -m "Production deploy: $(date '+%Y-%m-%d %H:%M')"

# –ü—É—à–∏–º –≤ main
echo "‚¨ÜÔ∏è –ü—É—à–∏–º –≤ main..."
git push origin main

echo "‚úÖ –î–µ–ø–ª–æ–π –∑–∞–ø—É—â–µ–Ω! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Render Dashboard"
echo "üîó https://dashboard.render.com"
