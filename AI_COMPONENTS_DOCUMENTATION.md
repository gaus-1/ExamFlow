# ü§ñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è AI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ ExamFlow

## üìã –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

–ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ AI —Å–∏—Å—Ç–µ–º–∞ ExamFlow —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:

### üèóÔ∏è –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏

1. **`ai/config.py`** - –ï–¥–∏–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤—Å–µ—Ö AI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
2. **`ai/optimized_service.py`** - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π AI —Å–µ—Ä–≤–∏—Å
3. **`telegram_bot/optimized_service.py`** - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±–æ—Ç —Å–µ—Ä–≤–∏—Å
4. **`core/rag_system/`** - RAG —Å–∏—Å—Ç–µ–º–∞ (–ø–æ–∏—Å–∫ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è)
5. **`telegram_bot/gamification.py`** - –°–∏—Å—Ç–µ–º–∞ –≥–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏–∏

---

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (`ai/config.py`)

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ AI —Å–∏—Å—Ç–µ–º—ã.

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–ª–∞—Å—Å—ã

#### `AIProviderConfig`
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (Gemini, OpenAI, etc.)
```python
@dataclass
class AIProviderConfig:
    name: str                    # –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
    api_key: str                 # API –∫–ª—é—á
    base_url: str                # –ë–∞–∑–æ–≤—ã–π URL
    model: str                   # –ú–æ–¥–µ–ª—å AI
    temperature: float = 0.7     # –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
    max_tokens: int = 1000       # –ú–∞–∫—Å–∏–º—É–º —Ç–æ–∫–µ–Ω–æ–≤
    timeout: int = 30            # –¢–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–∞
    priority: int = 1            # –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç (1 = –≤—ã—Å—à–∏–π)
    is_active: bool = True       # –ê–∫—Ç–∏–≤–µ–Ω –ª–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä
```

#### `RAGConfig`
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è RAG —Å–∏—Å—Ç–µ–º—ã
```python
@dataclass
class RAGConfig:
    max_context_tokens: int = 4000      # –ú–∞–∫—Å–∏–º—É–º —Ç–æ–∫–µ–Ω–æ–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
    max_response_tokens: int = 1000     # –ú–∞–∫—Å–∏–º—É–º —Ç–æ–∫–µ–Ω–æ–≤ –æ—Ç–≤–µ—Ç–∞
    top_k_chunks: int = 5               # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
    similarity_threshold: float = 0.7   # –ü–æ—Ä–æ–≥ —Å—Ö–æ–∂–µ—Å—Ç–∏
    cache_ttl: int = 600                # –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∫—ç—à–∞ (—Å–µ–∫)
    timeout_seconds: int = 30           # –¢–∞–π–º–∞—É—Ç RAG –∑–∞–ø—Ä–æ—Å–æ–≤
```

#### `LimitsConfig`
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ª–∏–º–∏—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
```python
@dataclass
class LimitsConfig:
    daily_guest_limit: int = 10      # –õ–∏–º–∏—Ç –¥–ª—è –≥–æ—Å—Ç–µ–π (–¥–µ–Ω—å)
    daily_auth_limit: int = 30       # –õ–∏–º–∏—Ç –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö (–¥–µ–Ω—å)
    weekly_auth_limit: int = 200     # –õ–∏–º–∏—Ç –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö (–Ω–µ–¥–µ–ª—è)
    monthly_auth_limit: int = 1000   # –õ–∏–º–∏—Ç –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö (–º–µ—Å—è—Ü)
```

### –®–∞–±–ª–æ–Ω—ã –ø—Ä–æ–º–ø—Ç–æ–≤

#### `PromptTemplates`
–ì–æ—Ç–æ–≤—ã–µ —à–∞–±–ª–æ–Ω—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∑–∞–¥–∞—á:

- **`SYSTEM_BASE`** - –ë–∞–∑–æ–≤—ã–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç
- **`TASK_EXPLANATION`** - –û–±—ä—è—Å–Ω–µ–Ω–∏–µ —Ä–µ—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏
- **`HINT_GENERATION`** - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–¥—Å–∫–∞–∑–æ–∫
- **`PERSONALIZED_HELP`** - –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–æ–º–æ—â—å
- **`LEARNING_PLAN`** - –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞–Ω–∞ –æ–±—É—á–µ–Ω–∏—è

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
```python
from ai.config import ai_config

# –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
provider = ai_config.get_provider_config('gemini')

# –ü–æ–ª—É—á–∏—Ç—å —à–∞–±–ª–æ–Ω –ø—Ä–æ–º–ø—Ç–∞
prompt = ai_config.get_prompt_template(
    'TASK_EXPLANATION',
    task_text="–†–µ—à–∏—Ç–µ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ x¬≤ + 5x + 6 = 0"
)

# –ü–æ–ª—É—á–∏—Ç—å –ª–∏–º–∏—Ç—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
limits = ai_config.get_limits_for_user(is_authenticated=True)
```

---

## üöÄ AI –°–µ—Ä–≤–∏—Å (`ai/optimized_service.py`)

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–ï–¥–∏–Ω—ã–π —Å–µ—Ä–≤–∏—Å –¥–ª—è –≤—Å–µ—Ö AI –æ–ø–µ—Ä–∞—Ü–∏–π —Å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π.

### –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã

#### `ask(prompt, user, task_type, use_rag, use_cache)`
–ì–ª–∞–≤–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è AI –∑–∞–ø—Ä–æ—Å–æ–≤
```python
result = ai_service.ask(
    prompt="–ö–∞–∫ —Ä–µ—à–∏—Ç—å –∫–≤–∞–¥—Ä–∞—Ç–Ω–æ–µ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ?",
    user=user,
    task_type="task_explanation",
    use_rag=True,
    use_cache=True
)
```

#### `explain_task(task_text, user)`
–û–±—ä—è—Å–Ω–µ–Ω–∏–µ —Ä–µ—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏
```python
result = ai_service.explain_task(
    task_text="x¬≤ + 5x + 6 = 0",
    user=user
)
```

#### `get_hint(task_text, user)`
–ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è –∑–∞–¥–∞—á–∏
```python
result = ai_service.get_hint(
    task_text="–ù–∞–π–¥–∏—Ç–µ –∫–æ—Ä–Ω–∏ —É—Ä–∞–≤–Ω–µ–Ω–∏—è",
    user=user
)
```

#### `get_personalized_help(task_text, user, user_level, weak_topics, strong_topics)`
–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–æ–º–æ—â—å
```python
result = ai_service.get_personalized_help(
    task_text="–†–µ—à–∏—Ç–µ –Ω–µ—Ä–∞–≤–µ–Ω—Å—Ç–≤–æ",
    user=user,
    user_level=3,
    weak_topics=["–∞–ª–≥–µ–±—Ä–∞", "—Ñ—É–Ω–∫—Ü–∏–∏"],
    strong_topics=["–≥–µ–æ–º–µ—Ç—Ä–∏—è"]
)
```

#### `get_learning_plan(user, current_level, accuracy, weak_topics, goal)`
–°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞–Ω–∞ –æ–±—É—á–µ–Ω–∏—è
```python
result = ai_service.get_learning_plan(
    user=user,
    current_level=3,
    accuracy=75.0,
    weak_topics=["–∞–ª–≥–µ–±—Ä–∞"],
    goal="–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –ï–ì–≠"
)
```

### –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –º–µ—Ç–æ–¥—ã

- **`_check_limits(user)`** - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **`_update_limits(user)`** - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤
- **`_get_cached_result(prompt, task_type)`** - –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∑ –∫—ç—à–∞
- **`_cache_result(prompt, task_type, result)`** - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫—ç—à
- **`_get_best_provider(task_type)`** - –í—ã–±–æ—Ä –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
- **`_prepare_prompt(prompt, user, task_type, use_rag)`** - –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø—Ä–æ–º–ø—Ç–∞
- **`_generate_response(prompt, provider_config, task_type)`** - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞
- **`_log_request(user, prompt, result, processing_time)`** - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## ü§ñ –ë–æ—Ç –°–µ—Ä–≤–∏—Å (`telegram_bot/optimized_service.py`)

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–ï–¥–∏–Ω—ã–π —Å–µ—Ä–≤–∏—Å –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π Telegram –±–æ—Ç–∞ —Å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π.

### –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã

#### `get_start_message(user_id)`
–ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
```python
message, keyboard = await bot_service.get_start_message(user_id)
```

#### `get_subjects_menu()`
–ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ–Ω—é –ø—Ä–µ–¥–º–µ—Ç–æ–≤
```python
message, keyboard = await bot_service.get_subjects_menu()
```

#### `get_subject_topics(subject_id)`
–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–º –ø—Ä–µ–¥–º–µ—Ç–∞
```python
message, keyboard = await bot_service.get_subject_topics(subject_id)
```

#### `get_random_task(subject_id)`
–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è
```python
message, keyboard = await bot_service.get_random_task(subject_id)
```

#### `get_ai_response(prompt, user_id, task_id)`
–ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ –æ—Ç AI
```python
message, keyboard = await bot_service.get_ai_response(
    prompt="–ö–∞–∫ —Ä–µ—à–∏—Ç—å —É—Ä–∞–≤–Ω–µ–Ω–∏–µ?",
    user_id=user_id,
    task_id=123
)
```

#### `get_user_stats(user_id)`
–ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```python
message, keyboard = await bot_service.get_user_stats(user_id)
```

### –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã

#### `_get_main_menu_keyboard()`
–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é —Å –∫–Ω–æ–ø–∫–∞–º–∏:
- üìö –ü—Ä–µ–¥–º–µ—Ç—ã
- üé≤ –°–ª—É—á–∞–π–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ
- ü§ñ AI –ü–æ–º–æ—â–Ω–∏–∫
- üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è

#### `_get_subjects_keyboard(subjects)`
–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ —Å –∫–Ω–æ–ø–∫–∞–º–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞

#### `_get_topics_keyboard(subject_id, topics)`
–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Ç–µ–º –ø—Ä–µ–¥–º–µ—Ç–∞

#### `_get_task_keyboard(task_id)`
–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –∑–∞–¥–∞–Ω–∏—è —Å –∫–Ω–æ–ø–∫–∞–º–∏:
- ü§ñ –û–±—ä—è—Å–Ω–∏—Ç—å
- üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞
- ‚úÖ –†–µ—à–µ–Ω–æ
- üé≤ –î—Ä—É–≥–æ–µ –∑–∞–¥–∞–Ω–∏–µ
- üîô –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é

#### `_get_ai_keyboard()`
–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ AI —Å –∫–Ω–æ–ø–∫–∞–º–∏:
- üîÑ –ù–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å
- üìö –ü—Ä–µ–¥–º–µ—Ç—ã
- üîô –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é

#### `_get_stats_keyboard()`
–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å –∫–Ω–æ–ø–∫–∞–º–∏:
- üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è
- üìà –ü—Ä–æ–≥—Ä–µ—Å—Å
- üîô –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é

---

## üîç RAG –°–∏—Å—Ç–µ–º–∞ (`core/rag_system/`)

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–°–∏—Å—Ç–µ–º–∞ –ø–æ–∏—Å–∫–∞ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π.

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### `orchestrator.py`
–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä RAG —Å–∏—Å—Ç–µ–º—ã
```python
from core.rag_system.orchestrator import RAGOrchestrator

orchestrator = RAGOrchestrator()
result = orchestrator.process_query(
    query="–ö–∞–∫ —Ä–µ—à–∏—Ç—å –∫–≤–∞–¥—Ä–∞—Ç–Ω–æ–µ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ?",
    subject="–º–∞—Ç–µ–º–∞—Ç–∏–∫–∞",
    user_id=123
)
```

#### `vector_store.py`
–í–µ–∫—Ç–æ—Ä–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞

#### `text_processor.py`
–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏

#### `search_api.py`
API –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π

#### `ai_api.py`
API –¥–ª—è AI –∑–∞–ø—Ä–æ—Å–æ–≤

---

## üéÆ –ì–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏—è (`telegram_bot/gamification.py`)

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–°–∏—Å—Ç–µ–º–∞ –≥–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–ª—è –º–æ—Ç–∏–≤–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

#### `add_points(user_id, points, reason)`
–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—á–∫–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
```python
result = await gamification.add_points(
    user_id=123,
    points=10,
    reason="–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç"
)
```

#### `check_achievements(user_id)`
–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
```python
achievements = await gamification.check_achievements(user_id)
```

#### `get_leaderboard(limit)`
–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –ª–∏–¥–µ—Ä–æ–≤
```python
leaders = await gamification.get_leaderboard(10)
```

#### `get_daily_challenges(user_id)`
–ü–æ–ª—É—á–µ–Ω–∏–µ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π
```python
challenges = await gamification.get_daily_challenges(user_id)
```

---

## üìä –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

### `ai/models.py`
- **`AiRequest`** - –ó–∞–ø—Ä–æ—Å—ã –∫ AI
- **`AiResponse`** - –û—Ç–≤–µ—Ç—ã AI
- **`AiProvider`** - –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã AI
- **`AiLimit`** - –õ–∏–º–∏—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### `authentication/models.py`
- **`UserProfile`** - –ü—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### `learning/models.py`
- **`Subject`** - –ü—Ä–µ–¥–º–µ—Ç—ã
- **`Task`** - –ó–∞–¥–∞–Ω–∏—è
- **`UserProgress`** - –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

## üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### –°—Ö–µ–º–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

```
Telegram Bot
    ‚Üì
OptimizedBotService
    ‚Üì
OptimizedAIService
    ‚Üì
AIConfig + RAGOrchestrator
    ‚Üì
AI Providers (Gemini, OpenAI)
```

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```python
# –í –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ –∫–æ–º–∞–Ω–¥—ã /start
from telegram_bot.optimized_service import bot_service

async def start_command(update, context):
    user_id = update.effective_user.id
    message, keyboard = await bot_service.get_start_message(user_id)
    await update.message.reply_text(message, reply_markup=keyboard)

# –í –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ AI –∑–∞–ø—Ä–æ—Å–∞
async def ai_query(update, context):
    user_id = update.effective_user.id
    prompt = update.message.text
    
    message, keyboard = await bot_service.get_ai_response(prompt, user_id)
    await update.message.reply_text(message, reply_markup=keyboard)
```

---

## üöÄ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### ‚úÖ –£—Å—Ç—Ä–∞–Ω–µ–Ω—ã –¥—É–±–ª–∏
- –£–¥–∞–ª–µ–Ω—ã –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è AI —Å–µ—Ä–≤–∏—Å—ã
- –û–±—ä–µ–¥–∏–Ω–µ–Ω—ã RAG —Å–∏—Å—Ç–µ–º—ã
- –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã –±–æ—Ç —Å–µ—Ä–≤–∏—Å—ã

### ‚úÖ –ï–¥–∏–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- –õ–µ–≥–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏
- –ì–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–∏–º–∏—Ç–æ–≤

### ‚úÖ –ü—Ä–∏–Ω—Ü–∏–ø –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–π –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- –ö–∞–∂–¥—ã–π –º–æ–¥—É–ª—å –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Å–≤–æ—é –æ–±–ª–∞—Å—Ç—å
- –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π
- –õ–µ–≥–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

### ‚úÖ –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–π —Å—Ç–∏–ª—å –∫–æ–¥–∞
- –ï–¥–∏–Ω—ã–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã
- –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
# AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã
GEMINI_API_KEY=your_gemini_key
OPENAI_API_KEY=your_openai_key

# RAG –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
RAG_CONFIG_MAX_CONTEXT_LENGTH=4000
RAG_CONFIG_MAX_SOURCES=5
RAG_CONFIG_SIMILARITY_THRESHOLD=0.7

# –õ–∏–º–∏—Ç—ã
AI_LIMITS_DAILY_GUEST=10
AI_LIMITS_DAILY_AUTH=30
```

### –ú–∏–≥—Ä–∞—Ü–∏–∏
```bash
python manage.py makemigrations
python manage.py migrate
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
python manage.py test ai
python manage.py test telegram_bot
```

---

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –õ–æ–≥–∏
- –í—Å–µ AI –∑–∞–ø—Ä–æ—Å—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ `AiRequest`
- –û—à–∏–±–∫–∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ Django –ª–æ–≥
- –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º
- –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ AI
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤
- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

---

## üîÆ –ü–ª–∞–Ω—ã —Ä–∞–∑–≤–∏—Ç–∏—è

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ (1-2 –Ω–µ–¥–µ–ª–∏)
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OpenAI API
- [ ] –£–ª—É—á—à–µ–Ω–∏–µ RAG —Å–∏—Å—Ç–µ–º—ã
- [ ] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ –∑–∞–¥–∞—á

### –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω—ã–µ (1-2 –º–µ—Å—è—Ü–∞)
- [ ] –ú–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏
- [ ] –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è
- [ ] A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ (3-6 –º–µ—Å—è—Ü–µ–≤)
- [ ] –°–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å AI
- [ ] –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–º–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º–∏
